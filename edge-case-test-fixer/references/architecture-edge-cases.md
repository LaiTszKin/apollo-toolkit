# 架構層常見邊緣案例（參考清單）

## 使用方式
- 只挑與本次變更直接相關的 2–5 項，避免全面掃描。
- 若變更涉及外部依賴/併發/排程/訊息系統，優先看對應區塊。

## 併發與同步
- 競態條件：同一資源被多工同時更新，導致覆寫或遺失更新
- 死鎖/活鎖：鎖順序不一致、重入鎖、或忙等
- 可見性/記憶體一致性：跨執行緒狀態未同步
- 非同步任務洩漏：背景任務未取消或未回收

## 背壓與資源
- 背壓失效：下游慢導致上游積壓、OOM、排隊過長
- 資源飢餓：高優先級任務長期佔用資源
- 連線池耗盡：未釋放或釋放延遲
- 檔案/Socket 洩漏：異常路徑未關閉

## 分散式系統
- 網路分割/暫時不可達：需要重試、降級或隔離
- 重試風暴：大量重試放大壓力
- 一致性落差：讀到過期資料或部分寫入
- 重複訊息：至少一次投遞導致重複處理
- 訊息順序：重排或亂序導致狀態錯亂
- 時鐘偏差：依賴時間排序/過期判斷失準

## 超時與取消
- 超時未傳播：子任務仍在執行造成資源占用
- 取消不可重入：重試後狀態不一致
- 超時邊界值：接近超時時行為抖動

## 錯誤處理與回滾
- 部分成功：跨步驟寫入只完成一半
- 回滾失敗：補償動作失敗導致資料不一致
- 例外被吞：錯誤未記錄或未上拋
- 冪等性缺失：重試造成重複副作用

## 部署與版本
- 滾動升級：新舊版本同時在跑，行為不一致
- 設定漂移：不同節點配置不一致
- 熱重載：重載時短暫不可用或狀態遺失
