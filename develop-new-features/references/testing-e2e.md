# E2E 測試原則

## 重要規則
- E2E 不再以「使用者是否明確要求」作為唯一條件。
- Agent 必須依據功能重要性、複雜度、跨層風險自行判斷是否建立 E2E。
- 關鍵使用者路徑且風險高的功能，應優先建立最小必要 E2E。
- 若 E2E 難以穩定、成本過高或受環境限制，至少補齊可覆蓋關鍵風險的整合測試，並記錄替代方案。

## 目的
- 驗證最關鍵的端到端使用者路徑是否可用。
- 捕捉跨系統、跨層整合後的行為落差。
- 在高風險情境提供接近真實使用流程的信心。

## 判斷準則
- 重要性：是否為核心功能、關鍵營收路徑或高影響流程。
- 複雜度：是否涉及多步驟狀態轉換、分支流程、跨服務協作。
- 風險：是否存在歷史回歸、整合脆弱點或使用者可見重大錯誤。
- 可維護性：是否可用可控測試資料與穩定環境執行。

## 不適用情境
- 功能風險低且可由單元/整合測試充分覆蓋。
- E2E 執行不穩定且成本遠高於收益，且已有整合測試可覆蓋關鍵風險。

## 設計要點
- 僅覆蓋最關鍵路徑，避免擴張為全面 UI 測試。
- 測試資料可控：固定 seed 或可回收測試資料。
- 追求穩定性：避免依賴不穩定外部系統，必要時使用替身環境。
- 成本透明：說明為何做或不做 E2E，並記錄替代測試策略。

## spec/checklist 填寫指引
- 在 `spec.md` 的需求描述中標示哪些路徑屬高風險關鍵路徑。
- 在 `checklist.md` 記錄 E2E 決策、對應測試案例與結果。
- 若不做 E2E，必須在 `checklist.md` 指定替代整合測試案例（IT-xx）與理由。
